# 配置更新说明

## 重要变更

已删除所有通过 OKX API 获取带单员信息的代码。现在系统**仅通过 Deepseek AI 分析 Discord 频道消息**来获取交易信息。

## 配置格式变更

### 旧格式（已废弃）
```bash
TRADER_CONFIG=trader1|1438413966714994699|35E22983F436F55B|带单员1
                                    ↑
                              这个 uniqueCode 不再需要
```

### 新格式
```bash
TRADER_CONFIG=trader1|1438413966714994699|带单员1
```

**格式说明**：`带单员ID|Discord频道ID|带单员名称`

**各部分含义**：
- `trader1`: 带单员ID（系统内部唯一标识）
- `1438413966714994699`: Discord频道ID（要监控的频道）
- `带单员1`: 带单员名称（前端显示用）

**多个带单员配置**（用分号分隔）：
```bash
TRADER_CONFIG=trader1|频道1|带单员1;trader2|频道2|带单员2
```

## 工作流程

1. **Discord消息监控**
   - 系统监控配置的 Discord 频道
   - 当有新消息时，使用 Deepseek AI 解析交易信息

2. **Deepseek AI 解析**
   - 从消息中提取：币种、方向（多/空）、进场价格、止盈价格、止损价格
   - 解析更新消息：状态变化、盈亏点数等

3. **实时状态计算**
   - 使用 OKX API 获取实时币价（仅用于价格查询）
   - 结合 Deepseek 解析的数据计算当前状态：
     - 未进场
     - 浮盈/浮亏（显示盈亏点数）
     - 已止盈/已止损（当价格触发止盈/止损时）

4. **前端展示**
   - 所有数据展示在前端界面
   - 实时更新交易状态和盈亏

## 已删除的功能

- ❌ OKX 带单员持仓查询
- ❌ OKX 带单员历史记录查询
- ❌ 通过 uniqueCode 获取带单员信息
- ❌ 自动判断"带单主动止盈/止损"（现在只能通过 Deepseek 解析的消息来判断）

## 保留的功能

- ✅ Deepseek AI 解析 Discord 消息
- ✅ 实时币价获取（用于计算盈亏）
- ✅ 交易状态计算（基于解析的数据和实时币价）
- ✅ 前端数据展示
- ✅ 用户登录和密码管理

## 更新 .env 文件

请更新你的 `.env` 文件，删除 `uniqueCode` 部分：

**修改前**：
```bash
TRADER_CONFIG=trader1|1438413966714994699|35E22983F436F55B|带单员1
```

**修改后**：
```bash
TRADER_CONFIG=trader1|1438413966714994699|带单员1
```

## Discord 命令变更

### 已删除的命令
- `/okx_leaders` - 获取带单员排行榜
- `/okx_current` - 获取带单员当前持仓
- `/okx_history` - 获取带单员历史持仓

### 保留的命令
- `/okx_price <symbol>` - 获取币种实时价格（例如：`/okx_price BTC-USDT-SWAP`）

## 注意事项

1. **状态判断**：系统现在只能通过 Deepseek 解析的消息来判断"带单主动止盈/止损"。如果带单员在 Discord 中发布了平仓消息，Deepseek 会解析并更新状态。

2. **数据来源**：
   - 进场价格、止盈、止损：来自 Deepseek 解析的 Discord 消息
   - 实时币价：来自 OKX 价格 API
   - 交易状态：基于上述数据计算

3. **配置更新后**：需要重启 Discord Bot 和 API 服务才能生效。

